<!-- Equipment Modal -->
<!-- Простое модальное окно для добавления/редактирования оборудования -->
<div id="equipment-modal" 
     class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
     data-controller="modal">
  <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
    <!-- Закрывающая кнопка -->
    <div class="absolute top-0 right-0 pt-4 p-4">
      <button type="button" onclick="closeEquipmentModal()" class="text-gray-400 hover:text-gray-600">
        <svg class="h-6 w-6 cursor-pointer " fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Контент модального окна -->
    <turbo-frame id="equipment-modal-frame" class="block">
      <!-- Контент будет загружен сюда -->
    </turbo-frame>
  </div>
</div>

<script>
  function openEquipmentModal() {
    // Открываем модальное окно - оно может быть пусто, но форма загрузится сразу
    const modal = document.getElementById('equipment-modal');
    if (modal) {
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
  }

  function closeEquipmentModal() {
    document.getElementById('equipment-modal').classList.add('hidden');
    document.body.style.overflow = 'auto';
    const frame = document.querySelector('turbo-frame#equipment-modal-frame');
    if (frame) {
      frame.innerHTML = '';
    }
  }

  // Слушаем успешное сохранение через Turbo Stream
  document.addEventListener('turbo:submit-end', function(e) {
    // Если форма в модальном окне успешно отправлена, закрываем модальное окно и обновляем страницу
    const modal = document.getElementById('equipment-modal');
    const isModalVisible = !modal.classList.contains('hidden');
    if (isModalVisible && e.detail && e.detail.success) {
      setTimeout(() => {
        closeEquipmentModal();
        // Обновляем страницу после закрытия модального окна
        setTimeout(() => {
          location.reload();
        }, 200);
      }, 100);
    }
  });

  // Закрытие по Escape
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeEquipmentModal();
    }
  });

  // Закрытие по клику вне модального окна
  document.getElementById('equipment-modal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeEquipmentModal();
    }
  });
</script>
